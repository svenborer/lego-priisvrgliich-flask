{% extends "base.html" %}

{% block content %}

<h1>{{ set_number }}</h1>

{% for info in set_information %}
    <p><a href="{{ url_for('sets_by_theme', theme=info['theme']) }}">{{ info['theme'] }}</a> > {{ info['subtheme'] }}</p>
    <p>
        Das isch d Set nummere <b>{{ info['set_number'] }} {{ info['name'] }}</b>.
        Es isch im Joor <b>{{ info['year'] }}</b> veröffentlicht worde.
        {% if info['ch_price'] %}
            Das Set het e Unvrbindligi Priisempfehlig vo <b>{{ info['ch_price'] }} CHF</b>.
        {% else %}
            E UVP fuer das Set isch leider nit vrfiegbar.
        {% endif %}
        Das Set het <b>{{ info['pieces'] }}</b> Stei und <b>{{ info['minifigs'] if info['minifigs'] else 0 }}</b> Minifigure{{ ' , also hets e original {} CHF pro LEGO stei'.format((info['ch_price']/info['pieces'])|round(2)) if info['ch_price'] and info['pieces'] }}.
        {% if offers %}
            S aktuell tiefschte Ahgebot liggt bi <b>{{ offers[0]['price'] }} CHF</b> und wird vo <b>{{ offers[0]['provider'] }}</b> ahbotte, das entspricht <b>{{ '{} CHF'.format((offers[0]['price']/info['pieces'])|round(2)) if offers[0]['price'] and info['pieces'] else 'N/A' }}</b> pro LEGO Stei.
            {% if info['ch_price'] %}
                Du wirdsch <b>{{ (info['ch_price']-offers[0]['price'])|round(2) }} CHF</b> spaare, was umgraechnet <b>{{ '{}%'.format(offers[0]['save_in_percentage_lp']|round(0)) }}</b> entspricht.
            {% endif %}
        {% else %}
            Das Set isch momentan nit ufem Maert.
        {% endif %}
    </p>
{% endfor %}

<h2>Informatione</h2>
<table class="table">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Joor</th>
            <th scope="col">Thema</th>
            <th scope="col">Unterthema</th>
            <th scope="col">Stei</th>
            <th scope="col">Minifigure</th>
            <th scope="col">UVP</th>
            <th scope="col">Bricklink</th>
        </tr>
    </thead>
    <tbody>
        {% for info in set_information %}
        <tr>
            <td>{{ info['set_number'] }}</td>
            <td>{{ info['name'] }}</td>
            <td>{{ info['year'] }}</td>
            <td>{{ info['theme'] }}</td>
            <td>{{ info['subtheme'] }}</td>
            <td>{{ info['pieces'] }}</td>
            <td>{{ info['minifigs'] }}</td>
            <td>{{ info['ch_price'] if info['ch_price'] }} CHF</td>
            <td>{{ '{} CHF ({}%)'.format(info['qty_avg_price'], info['difference']|round(0)) if info['difference'] else 'N/A' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if offers %}

<h2>Aktuelli Ahgebot</h2>
<table class="table">
    <thead>
        <tr>
            <th scope="col"></th>
            <th scope="col">Ahbieter</th>
            <th scope="col">URL</th>
            <th scope="col">Priis</th>
            <th scope="col">UVP Differänz</th>
            <th scope="col">BL Differänz</th>
            <th scope="col">Scan ID</th>
        </tr>
    </thead>
    <tbody>
        {% for offer in offers %}
        <tr>
            <td>
            {% if offer['availability'] == 3 %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14" style="color: #73c44d; fill: currentColor;">
                    <circle cx="8" cy="8" r="8"></circle>
                </svg>
            {% elif offer['availability'] == 4 %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14" style="color: #3495eb; fill: currentColor;">
                    <circle cx="8" cy="8" r="8"></circle>
                </svg>
            {% elif offer['availability'] == 2 %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14" style="color: #ffcc00; fill: currentColor;">
                    <circle cx="8" cy="8" r="8"></circle>
                </svg>
            {% elif offer['availability'] == 1 %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14" style="color: #ff3300; fill: currentColor;">
                    <circle cx="8" cy="8" r="8"></circle>
                </svg>
            {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14" style="color: #b3b3b3; fill: currentColor;">
                    <circle cx="8" cy="8" r="8"></circle>
                </svg>
            {% endif %}
            </td>
            <td>{{ offer['provider'] }}</td>
            <td><a href="{{ offer['url'] }}">Do gohts zum Ahgebot.</a></td>
            <td>{{ offer['price']|round(2) }} CHF</td>
            <td>{{ '{}%'.format(offer['save_in_percentage_lp']|round(0)) if offer['save_in_percentage_lp'] else 0 }}</td>
            <td>{{ '{}%'.format(offer['save_in_percentage_bl']|round(0)) if offer['save_in_percentage_bl'] else 'N/A' }}</td>
            <td>{{ offer['scan_id'] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endif %}

{% if prices%}

<h2>Priis Chart</h2>

{% include '_price_chart.html' %}

{% endif %}

{% endblock %}